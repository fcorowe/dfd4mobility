<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Digital Footprint Data to Measure and Monitor Human Mobility - Spatial patterns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./overview.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Spatial patterns</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Using Digital Footprint Data to Measure and Monitor Human Mobility</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/fcorowe/dfd4mobility" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial-patterns.html" class="sidebar-item-text sidebar-link active">Spatial patterns</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aims" id="toc-aims" class="nav-link active" data-scroll-target="#aims">Aims</a></li>
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link" data-scroll-target="#dependencies">Dependencies</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#meta-facebook-mobility-data" id="toc-meta-facebook-mobility-data" class="nav-link" data-scroll-target="#meta-facebook-mobility-data">Meta-Facebook mobility data</a></li>
  <li><a href="#bing-tiles" id="toc-bing-tiles" class="nav-link" data-scroll-target="#bing-tiles">Bing tiles</a></li>
  <li><a href="#administrative-areas" id="toc-administrative-areas" class="nav-link" data-scroll-target="#administrative-areas">Administrative areas</a></li>
  </ul></li>
  <li><a href="#spatial-indicators-of-human-mobility" id="toc-spatial-indicators-of-human-mobility" class="nav-link" data-scroll-target="#spatial-indicators-of-human-mobility">Spatial indicators of human mobility</a>
  <ul class="collapse">
  <li><a href="#origin-based-indicators" id="toc-origin-based-indicators" class="nav-link" data-scroll-target="#origin-based-indicators">Origin-based indicators</a></li>
  <li><a href="#destination-based-indicators" id="toc-destination-based-indicators" class="nav-link" data-scroll-target="#destination-based-indicators">Destination-based indicators</a></li>
  <li><a href="#intraflows" id="toc-intraflows" class="nav-link" data-scroll-target="#intraflows">Intraflows</a></li>
  <li><a href="#netflows" id="toc-netflows" class="nav-link" data-scroll-target="#netflows">Netflows</a></li>
  </ul></li>
  <li><a href="#mapping" id="toc-mapping" class="nav-link" data-scroll-target="#mapping">Mapping</a>
  <ul class="collapse">
  <li><a href="#handling-spatial-data" id="toc-handling-spatial-data" class="nav-link" data-scroll-target="#handling-spatial-data">Handling spatial data</a></li>
  <li><a href="#choropleths" id="toc-choropleths" class="nav-link" data-scroll-target="#choropleths">Choropleths</a></li>
  <li><a href="#interactive-mapping" id="toc-interactive-mapping" class="nav-link" data-scroll-target="#interactive-mapping">Interactive mapping</a></li>
  <li><a href="#flow-mapping" id="toc-flow-mapping" class="nav-link" data-scroll-target="#flow-mapping">Flow mapping</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Spatial patterns</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="aims" class="level2">
<h2 class="anchored" data-anchor-id="aims">Aims</h2>
</section>
<section id="dependencies" class="level2">
<h2 class="anchored" data-anchor-id="dependencies">Dependencies</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data wrangling</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#library(fs)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(here)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial data wrangling</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapdeck)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># data visualisation</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis) </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#library(viridisLite)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#library(gifski)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggnewscale)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="meta-facebook-mobility-data" class="level3">
<h3 class="anchored" data-anchor-id="meta-facebook-mobility-data">Meta-Facebook mobility data</h3>
<p>Read and describe Meta-Facebook mobility data</p>
<p>Data for April 2020</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df20 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/fb/movement_adm/2020_04.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"CL"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29,491
Columns: 20
$ GEOMETRY                     &lt;chr&gt; "LINESTRING (-69.96872527689874 -23.40113…
$ date_time                    &lt;chr&gt; "2020-04-01 00:00", "2020-04-01 00:00", "…
$ start_polygon_id             &lt;chr&gt; "60845", "60862", "60845", "60862", "6086…
$ start_polygon_name           &lt;chr&gt; "Antofagasta", "Cardenal Caro", "Antofaga…
$ end_polygon_id               &lt;chr&gt; "60847", "60890", "60846", "60863", "6089…
$ end_polygon_name             &lt;chr&gt; "Tocopilla", "Melipilla", "El Loa", "Colc…
$ length_km                    &lt;dbl&gt; 139.7543134, 24.0764953, 100.3339392, 24.…
$ tile_size                    &lt;dbl&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…
$ country                      &lt;chr&gt; "CL", "CL", "CL", "CL", "CL", "CL", "CL",…
$ level                        &lt;chr&gt; "LEVEL3", "LEVEL3", "LEVEL3", "LEVEL3", "…
$ n_crisis                     &lt;dbl&gt; 79, 18, 320, 71, NA, 369, NA, 20, 11, NA,…
$ n_baseline                   &lt;dbl&gt; 59.50, 25.50, 671.00, 132.75, NA, 559.25,…
$ n_difference                 &lt;dbl&gt; 19.50, -7.50, -351.00, -61.75, NA, -190.2…
$ percent_change               &lt;dbl&gt; 32.231405, -28.301887, -52.232143, -46.16…
$ is_statistically_significant &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ z_score                      &lt;dbl&gt; 2.0148470, -0.6837043, -4.0000000, -1.261…
$ start_lat                    &lt;dbl&gt; -24.32798, -34.32667, -24.32798, -34.3266…
$ start_lon                    &lt;dbl&gt; -69.56718, -71.78028, -69.56718, -71.7802…
$ end_lat                      &lt;dbl&gt; -22.06894, -33.75413, -22.81611, -34.7036…
$ end_lon                      &lt;dbl&gt; -69.60081, -71.19829, -68.20015, -71.0631…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>unique_origins <span class="ot">&lt;-</span> <span class="fu">unique</span>(df20<span class="sc">$</span>start_polygon_name)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>unique_destinations <span class="ot">&lt;-</span> <span class="fu">unique</span>(df20<span class="sc">$</span>end_polygon_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bing-tiles" class="level3">
<h3 class="anchored" data-anchor-id="bing-tiles">Bing tiles</h3>
<p>Read and describe Bing tile grids and how they can be created - reference to our work.</p>
<p>R spatial ecosystem to handle spatial data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bing_grid <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"./data/shp/grid/chile_grid.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span>T,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">dTolerance =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span>  <span class="co"># 1km</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="spatial-patterns_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="administrative-areas" class="level3">
<h3 class="anchored" data-anchor-id="administrative-areas">Administrative areas</h3>
<p>Read and describe administrative areas. Explain spatial data frames: geometry, projection, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>shp_adm <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"./data/shp/adm/gadm41_CHL_3.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span>T,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">dTolerance =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span>  <span class="co"># 1km</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    NL_NAME_1, NL_NAME_2, VARNAME_3, NL_NAME_3, CC_3, HASC_3</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ) )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>shp_adm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 345 features and 10 fields (with 1 geometry empty)
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -109.4488 ymin: -55.97871 xmax: -66.41821 ymax: -17.49952
Geodetic CRS:  WGS 84
# A tibble: 345 × 11
   GID_3       GID_0 COUNTRY GID_1   NAME_1 GID_2 NAME_2 NAME_3 TYPE_3 ENGTYPE_3
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;    
 1 CHL.2.1.1_1 CHL   Chile   CHL.2_1 Antof… CHL.… Antof… Antof… Comuna Municipa…
 2 CHL.2.1.2_1 CHL   Chile   CHL.2_1 Antof… CHL.… Antof… Mejil… Comuna Municipa…
 3 CHL.2.1.3_1 CHL   Chile   CHL.2_1 Antof… CHL.… Antof… Sierr… Comuna Municipa…
 4 CHL.2.1.4_1 CHL   Chile   CHL.2_1 Antof… CHL.… Antof… Taltal Comuna Municipa…
 5 CHL.2.2.1_1 CHL   Chile   CHL.2_1 Antof… CHL.… El Loa Calama Comuna Municipa…
 6 CHL.2.2.2_1 CHL   Chile   CHL.2_1 Antof… CHL.… El Loa Ollag… Comuna Municipa…
 7 CHL.2.2.3_1 CHL   Chile   CHL.2_1 Antof… CHL.… El Loa San P… Comuna Municipa…
 8 CHL.2.3.1_1 CHL   Chile   CHL.2_1 Antof… CHL.… Tocop… María… Comuna Municipa…
 9 CHL.2.3.2_1 CHL   Chile   CHL.2_1 Antof… CHL.… Tocop… Tocop… Comuna Municipa…
10 CHL.3.1.1_1 CHL   Chile   CHL.3_1 Arauc… CHL.… Cautín Carah… Comuna Municipa…
# ℹ 335 more rows
# ℹ 1 more variable: geometry &lt;POLYGON [°]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="spatial-patterns_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="spatial-indicators-of-human-mobility" class="level2">
<h2 class="anchored" data-anchor-id="spatial-indicators-of-human-mobility">Spatial indicators of human mobility</h2>
<section id="origin-based-indicators" class="level3">
<h3 class="anchored" data-anchor-id="origin-based-indicators">Origin-based indicators</h3>
<p>This measure is in relation to a baseline - percentage change and flow</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>origin_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_perchange =</span> <span class="fu">mean</span>(percent_change, <span class="at">na.rm =</span> T),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff_flow =</span> <span class="fu">mean</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_diff_flow =</span> <span class="fu">sum</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_outflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_outflow =</span> <span class="fu">sum</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(origin_df, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   start_polygon_name mean_perchange mean_diff_flow sum_diff_flow mean_outflow
   &lt;chr&gt;                       &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1 Santiago                   -70.6         -792.      -1309523.         612. 
 2 Talagante                  -33.8         -263.       -127657.         269. 
 3 Talca                      -52.4         -150.        -70768          115. 
 4 Tamarugal                   24.0          -53.0        -7261.          90.8
 5 Tierra del Fuego           -76.7          -19.8         -119.          12.2
 6 Tocopilla                  147.            -4.23        -702.          38.5
 7 Valdivia                   -75.8         -234.        -65400.          48.3
 8 Valparaíso                 -62.3         -350.       -257762.         169. 
 9 Ñuble                      -62.5         -165.        -56482.          60.4
10 Última Esperanza             1.77         -21.4          -21.4         10  
# ℹ 1 more variable: sum_outflow &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="destination-based-indicators" class="level3">
<h3 class="anchored" data-anchor-id="destination-based-indicators">Destination-based indicators</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>destination_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_perchange =</span> <span class="fu">mean</span>(percent_change, <span class="at">na.rm =</span> T),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff_flow =</span> <span class="fu">mean</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_diff_flow =</span> <span class="fu">sum</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_inflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_inflow =</span> <span class="fu">sum</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(destination_df, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   end_polygon_name mean_perchange mean_diff_flow sum_diff_flow mean_inflow
   &lt;chr&gt;                     &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
 1 Santiago                  -72.1       -850.        -1336029.       639. 
 2 Talagante                 -30.3       -266.         -128140        273. 
 3 Talca                     -52.1       -147.          -68827        117. 
 4 Tamarugal                  30.0        -49.4          -7360.        88.9
 5 Tierra del Fuego          -68.3        -16             -112         13.1
 6 Tocopilla                  63.3         -0.899         -165.        36.6
 7 Valdivia                  -71.2       -230.          -63284.        48.2
 8 Valparaíso                -66.2       -341.         -245913.       170. 
 9 Ñuble                     -63.1       -158.          -57870.        58.0
10 Última Esperanza          -12.8        NaN                0        NaN  
# ℹ 1 more variable: sum_inflow &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="intraflows" class="level3">
<h3 class="anchored" data-anchor-id="intraflows">Intraflows</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>origin_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">==</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_perchange =</span> <span class="fu">mean</span>(percent_change, <span class="at">na.rm =</span> T),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_diff_flow =</span> <span class="fu">mean</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_diff_flow =</span> <span class="fu">sum</span>(n_difference, <span class="at">na.rm =</span> T),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_intraflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_intraflow =</span> <span class="fu">sum</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(origin_df, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   start_polygon_name mean_perchange mean_diff_flow sum_diff_flow mean_intraflow
   &lt;chr&gt;                       &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
 1 Santiago                    6.00         32253.       2902809.        585443 
 2 Talagante                  24.0           3776.        339841.         19627.
 3 Talca                       4.48          1479.        133093.         34622.
 4 Tamarugal                 -15.4           -612.        -55063.          3342.
 5 Tierra del Fuego            1.62            13.6         1228.           886.
 6 Tocopilla                  14.5            121.         10931            976.
 7 Valdivia                  -10.6          -2895.       -260512.         24506.
 8 Valparaíso                 -1.27         -1295.       -116524.        101255.
 9 Ñuble                      -0.441         -158.        -14207.         36391.
10 Última Esperanza          -18.7           -164.        -14750.           712.
# ℹ 1 more variable: sum_intraflow &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="netflows" class="level3">
<h3 class="anchored" data-anchor-id="netflows">Netflows</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean outflow by area</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>outflows_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_outflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mean inflow by area</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>inflows_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_inflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data frames</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>netflow_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(inflows_df, outflows_df)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># mean netflow by area</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>netflow_df <span class="ot">&lt;-</span> netflow_df <span class="sc">%&gt;%</span> </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_netflow =</span> mean_inflow <span class="sc">-</span> mean_outflow</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(start_polygon_name, end_polygon_name, mean_inflow, mean_outflow, mean_netflow)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(netflow_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  start_polygon_name end_polygon_name mean_inflow mean_outflow mean_netflow
1        Antofagasta      Antofagasta    63.27513     66.00571    -2.730582
2             Arauco           Arauco    91.14286     93.48276    -2.339901
3              Arica            Arica    17.44444     20.16379    -2.719349
4              Aysen            Aysen    28.47297     27.15385     1.319127
5            Bío-Bío          Bío-Bío    77.86880     79.00000    -1.131195
6          Cachapoal        Cachapoal   110.54008    112.71988    -2.179800</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> netflow_df) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_netflow),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha=</span><span class="fl">0.5</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour=</span><span class="st">"darkblue"</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">2</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial-patterns_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="mapping" class="level2">
<h2 class="anchored" data-anchor-id="mapping">Mapping</h2>
<p>Colour palettes</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why to create geovisualisations?</p>
</div>
</div>
<p>For creating maps, cartography is important. A carefully crafted map can be an effective way of communicating complex information. Design issues include poor placement, size and readability of text and careless selection of colors. Have a look the style guide of the Journal of Maps for details.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For colour palettes, we recommend the following resources:</p>
<ul>
<li><p>the R packages <code>viridis</code> and <code>RColorBrewer</code></p></li>
<li><p>the website <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">color brewer 2.0</a></p></li>
<li><p>a publication by <span class="citation" data-cites="crameri2020">Crameri, Shephard, and Heron (<a href="#ref-crameri2020" role="doc-biblioref">2020</a>)</span></p></li>
</ul>
</div>
</div>
<section id="handling-spatial-data" class="level3">
<h3 class="anchored" data-anchor-id="handling-spatial-data">Handling spatial data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set crs</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>crs_default <span class="ot">=</span> <span class="st">"EPSG:4326"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df20 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/fb/movement_adm/2020_04.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"CL"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"start_lon"</span>, <span class="st">"start_lat"</span>), </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">crs =</span> crs_default)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29,491
Columns: 19
$ GEOMETRY                     &lt;chr&gt; "LINESTRING (-69.96872527689874 -23.40113…
$ date_time                    &lt;chr&gt; "2020-04-01 00:00", "2020-04-01 00:00", "…
$ start_polygon_id             &lt;chr&gt; "60845", "60862", "60845", "60862", "6086…
$ start_polygon_name           &lt;chr&gt; "Antofagasta", "Cardenal Caro", "Antofaga…
$ end_polygon_id               &lt;chr&gt; "60847", "60890", "60846", "60863", "6089…
$ end_polygon_name             &lt;chr&gt; "Tocopilla", "Melipilla", "El Loa", "Colc…
$ length_km                    &lt;dbl&gt; 139.7543134, 24.0764953, 100.3339392, 24.…
$ tile_size                    &lt;dbl&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…
$ country                      &lt;chr&gt; "CL", "CL", "CL", "CL", "CL", "CL", "CL",…
$ level                        &lt;chr&gt; "LEVEL3", "LEVEL3", "LEVEL3", "LEVEL3", "…
$ n_crisis                     &lt;dbl&gt; 79, 18, 320, 71, NA, 369, NA, 20, 11, NA,…
$ n_baseline                   &lt;dbl&gt; 59.50, 25.50, 671.00, 132.75, NA, 559.25,…
$ n_difference                 &lt;dbl&gt; 19.50, -7.50, -351.00, -61.75, NA, -190.2…
$ percent_change               &lt;dbl&gt; 32.231405, -28.301887, -52.232143, -46.16…
$ is_statistically_significant &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ z_score                      &lt;dbl&gt; 2.0148470, -0.6837043, -4.0000000, -1.261…
$ end_lat                      &lt;dbl&gt; -22.06894, -33.75413, -22.81611, -34.7036…
$ end_lon                      &lt;dbl&gt; -69.60081, -71.19829, -68.20015, -71.0631…
$ geometry                     &lt;POINT [°]&gt; POINT (-69.56718 -24.32798), POINT …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>shp_adm <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"./data/shp/adm/gadm41_CHL_3.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span>T,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">dTolerance =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span>  <span class="co"># 1km</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="fu">c</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    NAME_3, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    ENGTYPE_3, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    geometry</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs_default)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>shp_adm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 345 features and 2 fields (with 1 geometry empty)
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -109.4488 ymin: -55.97871 xmax: -66.41821 ymax: -17.49952
Geodetic CRS:  WGS 84
# A tibble: 345 × 3
   NAME_3               ENGTYPE_3                                       geometry
 * &lt;chr&gt;                &lt;chr&gt;                                      &lt;POLYGON [°]&gt;
 1 Antofagasta          Municipality ((-70.60031 -23.4473, -70.60352 -23.46711,…
 2 Mejillones           Municipality ((-70.02407 -23.06381, -69.98062 -22.95599…
 3 Sierra Gorda         Municipality ((-68.69855 -23.92313, -68.69079 -23.85126…
 4 Taltal               Municipality ((-70.4239 -24.61988, -70.56963 -24.55613,…
 5 Calama               Municipality ((-68.01055 -22.03307, -68.19283 -21.90586…
 6 Ollagüe              Municipality ((-68.05991 -21.77872, -68.18056 -21.60407…
 7 San Pedro de Atacama Municipality ((-67.18149 -22.8142, -67.61008 -22.90392,…
 8 María Elena          Municipality ((-69.96878 -22.86768, -69.53614 -22.88021…
 9 Tocopilla            Municipality ((-70.26542 -22.62504, -69.96545 -22.42489…
10 Carahue              Municipality ((-73.06431 -38.47689, -73.10936 -38.44577…
# ℹ 335 more rows</code></pre>
</div>
</div>
<p>Recompute <!--# recompute metrics to preserve the geometry --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean outflow by area</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>outflows_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(start_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_outflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mean inflow by area</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>inflows_df <span class="ot">&lt;-</span> df20 <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_polygon_name <span class="sc">!=</span> end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_polygon_name) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_inflow =</span> <span class="fu">mean</span>(n_crisis, <span class="at">na.rm =</span> T)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data frames</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>netflow_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(outflows_df, inflows_df)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># mean netflow by area</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>netflow_df <span class="ot">&lt;-</span> netflow_df <span class="sc">%&gt;%</span> </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_netflow =</span> mean_inflow <span class="sc">-</span> mean_outflow</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(start_polygon_name, mean_inflow, mean_outflow, mean_netflow, geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">polygon_name =</span> start_polygon_name</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(netflow_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 4 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -73.58022 ymin: -45.45868 xmax: -69.56718 ymax: -18.71308
Geodetic CRS:  WGS 84
  polygon_name mean_inflow mean_outflow mean_netflow
1  Antofagasta    63.27513     66.00571    -2.730582
2       Arauco    91.14286     93.48276    -2.339901
3        Arica    17.44444     20.16379    -2.719349
4        Aysen    28.47297     27.15385     1.319127
5      Bío-Bío    77.86880     79.00000    -1.131195
6    Cachapoal   110.54008    112.71988    -2.179800
                     geometry
1 POINT (-69.56718 -24.32798)
2  POINT (-73.3454 -37.72772)
3 POINT (-69.85541 -18.71308)
4 POINT (-73.58022 -45.45868)
5 POINT (-71.92786 -37.53828)
6  POINT (-70.7088 -34.28421)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(netflow_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51</code></pre>
</div>
</div>
<p>Join point-in-polygons</p>
<!--# The join is wrong - look at the names! -->
<p>Overlay start points from the mobility dataset over the polygons. Extract start points from the linestring geometry and use that to create the shapefile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mob_indicators <span class="ot">&lt;-</span> <span class="fu">st_join</span>(shp_adm, netflow_df)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mob_indicators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 345 features and 6 fields (with 1 geometry empty)
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -109.4488 ymin: -55.97871 xmax: -66.41821 ymax: -17.49952
Geodetic CRS:  WGS 84
# A tibble: 345 × 7
   NAME_3           ENGTYPE_3                  geometry polygon_name mean_inflow
 * &lt;chr&gt;            &lt;chr&gt;                 &lt;POLYGON [°]&gt; &lt;chr&gt;              &lt;dbl&gt;
 1 Antofagasta      Municipa… ((-70.60031 -23.4473, -7… Antofagasta         63.3
 2 Mejillones       Municipa… ((-70.02407 -23.06381, -… &lt;NA&gt;                NA  
 3 Sierra Gorda     Municipa… ((-68.69855 -23.92313, -… &lt;NA&gt;                NA  
 4 Taltal           Municipa… ((-70.4239 -24.61988, -7… &lt;NA&gt;                NA  
 5 Calama           Municipa… ((-68.01055 -22.03307, -… &lt;NA&gt;                NA  
 6 Ollagüe          Municipa… ((-68.05991 -21.77872, -… &lt;NA&gt;                NA  
 7 San Pedro de At… Municipa… ((-67.18149 -22.8142, -6… El Loa              93.2
 8 María Elena      Municipa… ((-69.96878 -22.86768, -… Tocopilla           36.6
 9 Tocopilla        Municipa… ((-70.26542 -22.62504, -… &lt;NA&gt;                NA  
10 Carahue          Municipa… ((-73.06431 -38.47689, -… &lt;NA&gt;                NA  
# ℹ 335 more rows
# ℹ 2 more variables: mean_outflow &lt;dbl&gt;, mean_netflow &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="choropleths" class="level3">
<h3 class="anchored" data-anchor-id="choropleths">Choropleths</h3>
<p>Choropleths are thematic maps. They are easy to create but also to get wrong. We will look at a set of the principles you can follow to create effective choropleth maps. Here three more questions to consider:</p>
<ul>
<li><p>What is being plotted?</p></li>
<li><p>What is the target audience?</p></li>
<li><p>What degree of interactivity we want to offer?</p></li>
</ul>
<p>Map flows - use code from uk migration paper</p>
<div class="cell">

</div>
<!--# Use rates - need to aggregate the FB for individual months -->
</section>
<section id="interactive-mapping" class="level3">
<h3 class="anchored" data-anchor-id="interactive-mapping">Interactive mapping</h3>
</section>
<section id="flow-mapping" class="level3">
<h3 class="anchored" data-anchor-id="flow-mapping">Flow mapping</h3>
<!--# Common concepts -->
<!--# There are several concepts relevant to understanding the data sets. First of all, we construct maps using two different methods of identifying locations: tiles and administrative polygons. -->
<!--#  The Bing Maps Tile System defines a series of grids at different resolution levels over a rectangular projection of the world (Schwartz 2018). Each level is constructed by dividing the previous level into fourths. We typically use Bing tile levels 13 through 16, where level 13 results in tiles that are about 4.9 x 4.9 km at the Equator. The other method we use for identifying a location is administrative polygons, which define the political and geographic boundaries of countries, states, provinces, counties, cities, and more. -->
<!--#  When generating a map for a crisis event, we specify a rectangular bounding box around the most directly affected area. The different map calculations, described in the following sections, are done relative to this region, and, for most of the maps, only data within this region is included. Most of the map types are based on counting events that occur within a time interval, which is frequently 8 or 24 hours. The time interval determines what data is included in a calculation as well as the minimum frequency with which new maps are generated.  -->


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-crameri2020" class="csl-entry" role="doc-biblioentry">
Crameri, Fabio, Grace E. Shephard, and Philip J. Heron. 2020. <span>“The Misuse of Colour in Science Communication.”</span> <em>Nature Communications</em> 11 (1). <a href="https://doi.org/10.1038/s41467-020-19160-7">https://doi.org/10.1038/s41467-020-19160-7</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./overview.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>